<!DOCTYPE html>
<html>
<head>
    <title>Dashboard</title>
    <style>
        body { font-family: Arial; background: #f0f2f5; padding: 20px; }
        .box {
            background: white; padding: 20px; border-radius: 12px;
            width: 600px; margin-bottom: 20px;
            box-shadow: 0px 4px 12px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>

<h1>Dashboard</h1>

<div id="resumeSection" class="box" style="display:none;">
    <h2>Upload Resume</h2>
    <form id="resumeForm">
        <input type="file" name="resume" required />
        <button type="submit">Upload</button>
    </form>
    <p id="uploadResult"></p>
</div>

<div class="box">
    <h2>Latest Yahoo News</h2>
    <div id="news-list">Loading...</div>
</div>

<script>
    // --- CHECK LOGIN BEFORE SHOWING ANYTHING ---
    fetch("/check-session")
        .then(res => res.json())
        .then(data => {
            if (!data.loggedIn) {
                window.location.href = "/login.html";
            } else {
                document.getElementById("resumeSection").style.display = "block";
            }
        });

    // --- RESUME UPLOAD ---
    document.getElementById("resumeForm").onsubmit = async (e) => {
        e.preventDefault();
        let formData = new FormData(e.target);

        let res = await fetch("/uploadResume", {
            method: "POST",
            body: formData
        });

        let out = await res.json();
        document.getElementById("uploadResult").innerText = out.message;
    };

    // --- LOAD NEWS ---
    async function loadNews() {
        const res = await fetch("/api/news");
        const data = await res.json();

        const container = document.getElementById("news-list");

        if (!data.success) {
            container.innerHTML = "Could not load news.";
            return;
        }

        container.innerHTML = data.articles.map(a => `
        <p>
            <a href="${a.link}" target="_blank">${a.title}</a><br>
            <small>${new Date(a.pubDate).toLocaleString()}</small>
        </p>
    `).join("");
    }
    loadNews();
</script>

</body>
</html>
